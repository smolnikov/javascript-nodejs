{"version":3,"sources":["webpack:///ebook.718527394608b9fb1793.js","webpack:///./handlers/ebook/client/index.js","webpack:///./client/spinner.js?1269****","webpack:///./client/xhr.js?6852***","webpack:///./client/getCsrfCookie.js?d12a***","webpack:///./handlers/payments/common/client/index.js?b91c","webpack:///./handlers/payments/common/client/formPayment.js?0610","webpack:///./handlers/ebook/client/orderForm.js"],"names":["ebook","webpackJsonp_name_",0,"module","exports","__webpack_require__","init","orderForm","document","querySelector","OrderForm","elem",150,"Spinner","options","this","size","elemClass","Error","createElement","prototype","start","classList","toggle","insertAdjacentHTML","stop","spinnerElem","remove",155,"xhr","wrapEvent","name","e","event","CustomEvent","originalEvent","fail","reason","request","dispatchEvent","success","result","XMLHttpRequest","method","body","url","open","sync","csrfCookie","getCsrfCookie","skipCsrf","setRequestHeader","toString","call","JSON","stringify","noDocumentEvents","addEventListener","timeStart","Date","now","raw","normalStatuses","status","indexOf","responseText","contentType","getResponseHeader","match","json","parse","setTimeout","send","notification",156,"cookie",176,"FormPayment",177,"_classCallCheck","instance","Constructor","TypeError","_createClass","defineProperties","target","props","i","length","descriptor","enumerable","configurable","writable","Object","defineProperty","key","protoProps","staticProps","paymentMethodElem","value","onEnd","startRequestIndication","bind","_this","add","spinner","class","paymentData","forEach","querySelectorAll","type","checked","_this2","orderData","getOrderData","readPaymentData","paymentMethod","invoiceCompanyName","focus","discountCode","window","location","search","orderTemplate","ga","id","product","variant","price","amount","quantity","step","option","metrika","reachGoal","description","message","form","orderNumber","container","hidden","innerHTML","appendChild","submitForm","called","firstChild","submit","hitCallback","number",181,"delegate","onSubmit","preventDefault","style","display","delegateTarget","chooser","dataset","elements","email","scrollIntoView","scrollBy","delegateMixin"],"mappings":"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","file":"ebook.718527394608b9fb1793.js","sourcesContent":["var ebook =\nwebpackJsonp_name_([8],{\n\n/***/ 0:\n/***/ function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\t\n\tvar OrderForm = __webpack_require__(181);\n\t\n\tfunction init() {\n\t\n\t  var orderForm = document.querySelector('[data-order-form]');\n\t  if (orderForm) {\n\t    new OrderForm({\n\t      elem: orderForm\n\t    });\n\t  }\n\t}\n\t\n\tinit();\n\n/***/ },\n\n/***/ 150:\n/***/ function(module, exports) {\n\n\t// Usage:\n\t//  1) new Spinner({ elem: elem}) -> start/stop()\n\t//  2) new Spinner() -> somewhere.append(spinner.elem) -> start/stop\n\t'use strict';\n\t\n\tfunction Spinner(options) {\n\t  options = options || {};\n\t  this.elem = options.elem;\n\t\n\t  this.size = options.size || 'medium';\n\t  // any class to add to spinner (make spinner special here)\n\t  this['class'] = options['class'] ? ' ' + options['class'] : '';\n\t\n\t  // any class to add to element (to hide it's content for instance)\n\t  this.elemClass = options.elemClass;\n\t\n\t  if (this.size != 'medium' && this.size != 'small' && this.size != 'large') {\n\t    throw new Error(\"Unsupported size: \" + this.size);\n\t  }\n\t\n\t  if (!this.elem) {\n\t    this.elem = document.createElement('div');\n\t  }\n\t}\n\t\n\tSpinner.prototype.start = function () {\n\t  if (this.elemClass) {\n\t    this.elem.classList.toggle(this.elemClass);\n\t  }\n\t\n\t  this.elem.insertAdjacentHTML('beforeend', '<span class=\"spinner spinner_active spinner_' + this.size + this['class'] + '\"><span class=\"spinner__dot spinner__dot_1\"></span><span class=\"spinner__dot spinner__dot_2\"></span><span class=\"spinner__dot spinner__dot_3\"></span></span>');\n\t};\n\t\n\tSpinner.prototype.stop = function () {\n\t  var spinnerElem = this.elem.querySelector('.spinner');\n\t  if (!spinnerElem) return; // already stopped or never started\n\t\n\t  spinnerElem.remove();\n\t\n\t  if (this.elemClass) {\n\t    this.elem.classList.toggle(this.elemClass);\n\t  }\n\t};\n\t\n\tmodule.exports = Spinner;\n\n/***/ },\n\n/***/ 155:\n/***/ function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\t\n\tvar notification = __webpack_require__(147);\n\tvar getCsrfCookie = __webpack_require__(156);\n\t// Wrapper about XHR\n\t// # Global Events\n\t// triggers document.loadstart/loadend on communication start/end\n\t//    --> unless options.noGlobalEvents is set\n\t//\n\t// # Events\n\t// triggers fail/success on load end:\n\t//    --> by default status=200 is ok, the others are failures\n\t//    --> options.normalStatuses = [201,409] allow given statuses\n\t//    --> fail event has .reason field\n\t//    --> success event has .result field\n\t//\n\t// # JSON\n\t//    --> send(object) calls JSON.stringify\n\t//    --> adds Accept: json (we want json) by default, unless options.raw\n\t// if options.json or server returned json content type\n\t//    --> autoparse json\n\t//    --> fail if error\n\t//\n\t// # CSRF\n\t//    --> requests sends header X-XSRF-TOKEN from cookie\n\t\n\tfunction xhr(options) {\n\t\n\t  var request = new XMLHttpRequest();\n\t\n\t  var method = options.method || 'GET';\n\t\n\t  var body = options.body;\n\t  var url = options.url;\n\t\n\t  request.open(method, url, options.sync ? false : true);\n\t\n\t  request.method = method;\n\t\n\t  // token/header names same as angular $http for easier interop\n\t  var csrfCookie = getCsrfCookie();\n\t  if (csrfCookie && !options.skipCsrf) {\n\t    request.setRequestHeader(\"X-XSRF-TOKEN\", csrfCookie);\n\t  }\n\t\n\t  if (({}).toString.call(body) == '[object Object]') {\n\t    // must be OPENed to setRequestHeader\n\t    request.setRequestHeader(\"Content-Type\", \"application/json;charset=UTF-8\");\n\t    body = JSON.stringify(body);\n\t  }\n\t\n\t  if (!options.noDocumentEvents) {\n\t    request.addEventListener('loadstart', function (event) {\n\t      request.timeStart = Date.now();\n\t      var e = wrapEvent('xhrstart', event);\n\t      document.dispatchEvent(e);\n\t    });\n\t    request.addEventListener('loadend', function (event) {\n\t      var e = wrapEvent('xhrend', event);\n\t      document.dispatchEvent(e);\n\t    });\n\t    request.addEventListener('success', function (event) {\n\t      var e = wrapEvent('xhrsuccess', event);\n\t      e.result = event.result;\n\t      document.dispatchEvent(e);\n\t    });\n\t    request.addEventListener('fail', function (event) {\n\t      var e = wrapEvent('xhrfail', event);\n\t      e.reason = event.reason;\n\t      document.dispatchEvent(e);\n\t    });\n\t  }\n\t\n\t  if (!options.raw) {\n\t    // means we want json\n\t    request.setRequestHeader(\"Accept\", \"application/json\");\n\t  }\n\t\n\t  request.setRequestHeader('X-Requested-With', \"XMLHttpRequest\");\n\t\n\t  var normalStatuses = options.normalStatuses || [200];\n\t\n\t  function wrapEvent(name, e) {\n\t    var event = new CustomEvent(name);\n\t    event.originalEvent = e;\n\t    return event;\n\t  }\n\t\n\t  function fail(reason, originalEvent) {\n\t    var e = wrapEvent(\"fail\", originalEvent);\n\t    e.reason = reason;\n\t    request.dispatchEvent(e);\n\t  }\n\t\n\t  function success(result, originalEvent) {\n\t    var e = wrapEvent(\"success\", originalEvent);\n\t    e.result = result;\n\t    request.dispatchEvent(e);\n\t  }\n\t\n\t  request.addEventListener(\"error\", function (e) {\n\t    fail(\"Ошибка связи с сервером.\", e);\n\t  });\n\t\n\t  request.addEventListener(\"timeout\", function (e) {\n\t    fail(\"Превышено максимально допустимое время ожидания ответа от сервера.\", e);\n\t  });\n\t\n\t  request.addEventListener(\"abort\", function (e) {\n\t    fail(\"Запрос был прерван.\", e);\n\t  });\n\t\n\t  request.addEventListener(\"load\", function (e) {\n\t    if (!request.status) {\n\t      // does that ever happen?\n\t      fail(\"Не получен ответ от сервера.\", e);\n\t      return;\n\t    }\n\t\n\t    if (normalStatuses.indexOf(request.status) == -1) {\n\t      fail(\"Ошибка на стороне сервера (код \" + request.status + \"), попытайтесь позднее.\", e);\n\t      return;\n\t    }\n\t\n\t    var result = request.responseText;\n\t    var contentType = request.getResponseHeader(\"Content-Type\");\n\t    if (contentType.match(/^application\\/json/) || options.json) {\n\t      // autoparse json if WANT or RECEIVED json\n\t      try {\n\t        result = JSON.parse(result);\n\t      } catch (e) {\n\t        fail(\"Некорректный формат ответа от сервера.\", e);\n\t        return;\n\t      }\n\t    }\n\t\n\t    success(result, e);\n\t  });\n\t\n\t  // defer to let other handlers be assigned\n\t  setTimeout(function () {\n\t    request.send(body);\n\t  }, 0);\n\t\n\t  return request;\n\t}\n\t\n\tdocument.addEventListener('xhrfail', function (event) {\n\t  new notification.Error(event.reason);\n\t});\n\t\n\tmodule.exports = xhr;\n\n/***/ },\n\n/***/ 156:\n/***/ function(module, exports) {\n\n\t\"use strict\";\n\t\n\tmodule.exports = function () {\n\t  var csrfCookie = document.cookie.match(/XSRF-TOKEN=([\\w-]+)/);\n\t  return csrfCookie ? csrfCookie[1] : null;\n\t};\n\n/***/ },\n\n/***/ 176:\n/***/ function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\t\n\texports.FormPayment = __webpack_require__(177);\n\n/***/ },\n\n/***/ 177:\n/***/ function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\t\n\tvar _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ('value' in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();\n\t\n\tfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError('Cannot call a class as a function'); } }\n\t\n\tvar notification = __webpack_require__(147);\n\tvar xhr = __webpack_require__(155);\n\tvar Spinner = __webpack_require__(150);\n\tvar Modal = __webpack_require__(153);\n\t\n\t/**\n\t * Get data from orderForm.getOrderData()\n\t * process payment, ask for more data if needed\n\t */\n\t\n\tvar FormPayment = (function () {\n\t  function FormPayment(orderForm, paymentMethodElem) {\n\t    _classCallCheck(this, FormPayment);\n\t\n\t    this.orderForm = orderForm;\n\t    this.paymentMethodElem = paymentMethodElem;\n\t  }\n\t\n\t  _createClass(FormPayment, [{\n\t    key: 'request',\n\t    value: function request(options) {\n\t      var request = xhr(options);\n\t\n\t      request.addEventListener('loadstart', (function () {\n\t        var onEnd = this.startRequestIndication();\n\t        request.addEventListener('loadend', onEnd);\n\t      }).bind(this));\n\t\n\t      return request;\n\t    }\n\t  }, {\n\t    key: 'startRequestIndication',\n\t    value: function startRequestIndication() {\n\t      var _this = this;\n\t\n\t      this.paymentMethodElem.classList.add('modal-overlay_light');\n\t\n\t      var spinner = new Spinner({\n\t        elem: this.paymentMethodElem.querySelector('[type=\"submit\"]'),\n\t        size: 'small',\n\t        'class': '',\n\t        elemClass: 'button_loading'\n\t      });\n\t      spinner.start();\n\t\n\t      return function () {\n\t        _this.paymentMethodElem.classList.remove('modal-overlay_light');\n\t        if (spinner) spinner.stop();\n\t      };\n\t    }\n\t  }, {\n\t    key: 'readPaymentData',\n\t    value: function readPaymentData() {\n\t      var paymentData = {};\n\t\n\t      [].forEach.call(this.paymentMethodElem.querySelectorAll('input,select,textarea'), function (elem) {\n\t        if ((elem.type == 'radio' || elem.type == 'checkbox') && !elem.checked) return;\n\t        paymentData[elem.name] = elem.value;\n\t      });\n\t\n\t      return paymentData;\n\t    }\n\t  }, {\n\t    key: 'submit',\n\t    value: function submit() {\n\t      var _this2 = this;\n\t\n\t      var orderData = this.orderForm.getOrderData();\n\t      if (!orderData) return;\n\t\n\t      var paymentData = this.readPaymentData();\n\t\n\t      if (!paymentData.paymentMethod) {\n\t        new notification.Error(\"Выберите метод оплаты.\");\n\t        return;\n\t      }\n\t\n\t      if (paymentData.paymentMethod == 'invoice' && !paymentData.invoiceCompanyName) {\n\t        new notification.Error(\"Укажите название компании.\");\n\t        this.paymentMethodElem.querySelector('[name=\"invoiceCompanyName\"]').focus();\n\t        return;\n\t      }\n\t\n\t      for (var key in paymentData) {\n\t        orderData[key] = paymentData[key];\n\t      }\n\t\n\t      var discountCode = window.location.search.match(/[?&]code=([-\\w]+)/);\n\t      if (discountCode) {\n\t        orderData.discountCode = discountCode[1];\n\t      }\n\t\n\t      // response status must be 200\n\t      var request = xhr({\n\t        method: 'POST',\n\t        url: '/payments/common/checkout',\n\t        normalStatuses: [200, 403, 400],\n\t        body: orderData\n\t      });\n\t\n\t      if (orderData.orderTemplate) {\n\t        window.ga('ec:addProduct', {\n\t          id: this.orderForm.product,\n\t          variant: orderData.orderTemplate,\n\t          price: orderData.amount,\n\t          quantity: 1\n\t        });\n\t      }\n\t\n\t      window.ga('ec:setAction', 'checkout', {\n\t        step: 1,\n\t        option: orderData.paymentMethod\n\t      });\n\t\n\t      window.metrika.reachGoal('CHECKOUT', {\n\t        product: this.orderForm.product,\n\t        method: orderData.paymentMethod,\n\t        price: orderData.amount\n\t      });\n\t\n\t      window.ga('send', 'event', 'payment', 'checkout', 'ebook');\n\t      window.ga('send', 'event', 'payment', 'checkout-method-' + orderData.paymentMethod, this.orderForm.product);\n\t\n\t      var onEnd = this.startRequestIndication();\n\t\n\t      request.addEventListener('success', function (event) {\n\t\n\t        if (request.status == 403) {\n\t          new notification.Error(\"<p>\" + (event.result.description || event.result.message) + \"</p><p>Пожалуйста, начните оформление заново.</p><p>Если вы считаете, что на сервере ошибка &mdash; свяжитесь со <a href='mailto:orders@javascript.ru'>службой поддержки</a>.</p>\");\n\t          onEnd();\n\t          return;\n\t        }\n\t\n\t        if (request.status == 400) {\n\t          new notification.Error(\"<p>\" + event.result.message + \"</p><p>Если вы считаете, что произошла ошибка &mdash; свяжитесь со <a href='mailto:orders@javascript.ru'>службой поддержки</a>.</p>\");\n\t          onEnd();\n\t          return;\n\t        }\n\t\n\t        var result = event.result;\n\t\n\t        if (result.form) {\n\t          // don't stop the spinner while submitting the form to the payment system!\n\t          // (still in progress)\n\t\n\t          window.ga('ec:setAction', 'purchase', {\n\t            id: result.orderNumber\n\t          });\n\t\n\t          var container = document.createElement('div');\n\t          container.hidden = true;\n\t          container.innerHTML = result.form;\n\t          document.body.appendChild(container);\n\t\n\t          // submit form after GA or after 500ms, which one comes sooner\n\t          var submitForm = function submitForm() {\n\t            if (!submitForm.called) {\n\t              submitForm.called = true;\n\t              container.firstChild.submit();\n\t            }\n\t          };\n\t\n\t          window.ga('send', 'event', 'payment', 'purchase', 'ebook', {\n\t            hitCallback: submitForm\n\t          });\n\t          setTimeout(submitForm, 500);\n\t\n\t          window.metrika.reachGoal('PURCHASE', {\n\t            product: _this2.orderForm.product,\n\t            method: orderData.paymentMethod,\n\t            price: orderData.amount,\n\t            number: result.orderNumber\n\t          });\n\t        } else {\n\t          console.error(result);\n\t          onEnd();\n\t          new notification.Error(\"Ошибка на сервере, свяжитесь со <a href='mailto:orders@javascript.ru'>службой поддержки</a>.\");\n\t        }\n\t      });\n\t\n\t      request.addEventListener('fail', onEnd);\n\t    }\n\t  }]);\n\t\n\t  return FormPayment;\n\t})();\n\t\n\tmodule.exports = FormPayment;\n\n/***/ },\n\n/***/ 181:\n/***/ function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\t\n\tvar _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ('value' in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();\n\t\n\tfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError('Cannot call a class as a function'); } }\n\t\n\tvar xhr = __webpack_require__(155);\n\tvar notification = __webpack_require__(147);\n\tvar delegate = __webpack_require__(148);\n\tvar FormPayment = __webpack_require__(176).FormPayment;\n\tvar Spinner = __webpack_require__(150);\n\tvar Modal = __webpack_require__(153);\n\t\n\tvar OrderForm = (function () {\n\t  function OrderForm(options) {\n\t    var _this = this;\n\t\n\t    _classCallCheck(this, OrderForm);\n\t\n\t    this.elem = options.elem;\n\t\n\t    this.product = 'ebook';\n\t\n\t    this.elem.addEventListener('submit', function (e) {\n\t      return _this.onSubmit(e);\n\t    });\n\t\n\t    this.delegate('[data-order-payment-change]', 'click', function (e) {\n\t      e.preventDefault();\n\t      this.elem.querySelector('[data-order-form-step-payment]').style.display = 'block';\n\t      this.elem.querySelector('[data-order-form-step-confirm]').style.display = 'none';\n\t      this.elem.querySelector('[data-order-form-step-receipt]').style.display = 'none';\n\t    });\n\t\n\t    this.delegate('.complex-form__extract .extract__item', 'click', function (e) {\n\t      e.delegateTarget.querySelector('[type=\"radio\"]').checked = true;\n\t    });\n\t  }\n\t\n\t  _createClass(OrderForm, [{\n\t    key: 'onSubmit',\n\t    value: function onSubmit(event) {\n\t      event.preventDefault();\n\t      new FormPayment(this, this.elem).submit();\n\t    }\n\t\n\t    // return orderData or nothing if validation failed\n\t  }, {\n\t    key: 'getOrderData',\n\t    value: function getOrderData() {\n\t      var orderData = {};\n\t\n\t      if (window.orderNumber) {\n\t        orderData.orderNumber = window.orderNumber;\n\t      } else {\n\t        var chooser = this.elem.querySelector('input[name=\"orderTemplate\"]:checked');\n\t        orderData.orderTemplate = chooser.value;\n\t        orderData.amount = chooser.dataset.amount; // for stats\n\t      }\n\t\n\t      if (this.elem.elements.email) {\n\t        if (!this.elem.elements.email.value) {\n\t          window.ga('send', 'event', 'payment', 'checkout-no-email', 'ebook');\n\t          window.metrika.reachGoal('CHECKOUT-NO-EMAIL', { product: 'ebook' });\n\t          new notification.Error(\"Введите email.\");\n\t          this.elem.elements.email.scrollIntoView();\n\t          setTimeout(function () {\n\t            window.scrollBy(0, -200);\n\t          }, 0);\n\t          this.elem.elements.email.focus();\n\t          return;\n\t        } else {\n\t          orderData.email = this.elem.elements.email.value;\n\t        }\n\t      }\n\t\n\t      return orderData;\n\t    }\n\t  }]);\n\t\n\t  return OrderForm;\n\t})();\n\t\n\tdelegate.delegateMixin(OrderForm.prototype);\n\t\n\tmodule.exports = OrderForm;\n\n/***/ }\n\n});\n\n\n/** WEBPACK FOOTER **\n ** ebook.718527394608b9fb1793.js\n **/","var OrderForm = require('./orderForm');\n\nfunction init() {\n\n\n  var orderForm = document.querySelector('[data-order-form]');\n  if (orderForm) {\n    new OrderForm({\n      elem: orderForm\n    });\n  }\n\n}\n\ninit();\n\n\n\n/** WEBPACK FOOTER **\n ** ./handlers/ebook/client/index.js\n **/","// Usage:\n//  1) new Spinner({ elem: elem}) -> start/stop()\n//  2) new Spinner() -> somewhere.append(spinner.elem) -> start/stop\nfunction Spinner(options) {\n  options = options || {};\n  this.elem = options.elem;\n\n  this.size = options.size || 'medium';\n  // any class to add to spinner (make spinner special here)\n  this.class = options.class ? (' ' + options.class) : '';\n\n  // any class to add to element (to hide it's content for instance)\n  this.elemClass = options.elemClass;\n\n  if (this.size != 'medium' && this.size != 'small' && this.size != 'large') {\n    throw new Error(\"Unsupported size: \" + this.size);\n  }\n\n  if (!this.elem) {\n    this.elem = document.createElement('div');\n  }\n}\n\nSpinner.prototype.start = function() {\n  if (this.elemClass) {\n    this.elem.classList.toggle(this.elemClass);\n  }\n\n  this.elem.insertAdjacentHTML('beforeend', '<span class=\"spinner spinner_active spinner_' + this.size + this.class + '\"><span class=\"spinner__dot spinner__dot_1\"></span><span class=\"spinner__dot spinner__dot_2\"></span><span class=\"spinner__dot spinner__dot_3\"></span></span>');\n};\n\nSpinner.prototype.stop = function() {\n  var spinnerElem = this.elem.querySelector('.spinner');\n  if (!spinnerElem) return; // already stopped or never started\n\n  spinnerElem.remove();\n\n  if (this.elemClass) {\n    this.elem.classList.toggle(this.elemClass);\n  }\n};\n\nmodule.exports = Spinner;\n\n\n\n/** WEBPACK FOOTER **\n ** ./client/spinner.js\n **/","var notification = require('client/notification');\nvar getCsrfCookie = require('client/getCsrfCookie');\n// Wrapper about XHR\n// # Global Events\n// triggers document.loadstart/loadend on communication start/end\n//    --> unless options.noGlobalEvents is set\n//\n// # Events\n// triggers fail/success on load end:\n//    --> by default status=200 is ok, the others are failures\n//    --> options.normalStatuses = [201,409] allow given statuses\n//    --> fail event has .reason field\n//    --> success event has .result field\n//\n// # JSON\n//    --> send(object) calls JSON.stringify\n//    --> adds Accept: json (we want json) by default, unless options.raw\n// if options.json or server returned json content type\n//    --> autoparse json\n//    --> fail if error\n//\n// # CSRF\n//    --> requests sends header X-XSRF-TOKEN from cookie\n\nfunction xhr(options) {\n\n  var request = new XMLHttpRequest();\n\n  var method = options.method || 'GET';\n\n  var body = options.body;\n  var url = options.url;\n\n  request.open(method, url, options.sync ? false : true);\n\n  request.method = method;\n\n  // token/header names same as angular $http for easier interop\n  var csrfCookie = getCsrfCookie();\n  if (csrfCookie && !options.skipCsrf) {\n    request.setRequestHeader(\"X-XSRF-TOKEN\", csrfCookie);\n  }\n\n  if ({}.toString.call(body) == '[object Object]') {\n    // must be OPENed to setRequestHeader\n    request.setRequestHeader(\"Content-Type\", \"application/json;charset=UTF-8\");\n    body = JSON.stringify(body);\n  }\n\n  if (!options.noDocumentEvents) {\n    request.addEventListener('loadstart', event => {\n      request.timeStart = Date.now();\n      var e = wrapEvent('xhrstart', event);\n      document.dispatchEvent(e);\n    });\n    request.addEventListener('loadend', event => {\n      var e = wrapEvent('xhrend', event);\n      document.dispatchEvent(e);\n    });\n    request.addEventListener('success', event => {\n      var e = wrapEvent('xhrsuccess', event);\n      e.result = event.result;\n      document.dispatchEvent(e);\n    });\n    request.addEventListener('fail', event => {\n      var e = wrapEvent('xhrfail', event);\n      e.reason = event.reason;\n      document.dispatchEvent(e);\n    });\n  }\n\n  if (!options.raw) { // means we want json\n    request.setRequestHeader(\"Accept\", \"application/json\");\n  }\n\n  request.setRequestHeader('X-Requested-With', \"XMLHttpRequest\");\n\n  var normalStatuses = options.normalStatuses || [200];\n\n  function wrapEvent(name, e) {\n    var event = new CustomEvent(name);\n    event.originalEvent = e;\n    return event;\n  }\n\n  function fail(reason, originalEvent) {\n    var e = wrapEvent(\"fail\", originalEvent);\n    e.reason = reason;\n    request.dispatchEvent(e);\n  }\n\n  function success(result, originalEvent) {\n    var e = wrapEvent(\"success\", originalEvent);\n    e.result = result;\n    request.dispatchEvent(e);\n  }\n\n  request.addEventListener(\"error\", e => {\n    fail(\"Ошибка связи с сервером.\", e);\n  });\n\n  request.addEventListener(\"timeout\", e => {\n    fail(\"Превышено максимально допустимое время ожидания ответа от сервера.\", e);\n  });\n\n  request.addEventListener(\"abort\", e => {\n    fail(\"Запрос был прерван.\", e);\n  });\n\n  request.addEventListener(\"load\", e => {\n    if (!request.status) { // does that ever happen?\n      fail(\"Не получен ответ от сервера.\", e);\n      return;\n    }\n\n    if (normalStatuses.indexOf(request.status) == -1) {\n      fail(\"Ошибка на стороне сервера (код \" + request.status + \"), попытайтесь позднее.\", e);\n      return;\n    }\n\n    var result = request.responseText;\n    var contentType = request.getResponseHeader(\"Content-Type\");\n    if (contentType.match(/^application\\/json/) || options.json) { // autoparse json if WANT or RECEIVED json\n      try {\n        result = JSON.parse(result);\n      } catch (e) {\n        fail(\"Некорректный формат ответа от сервера.\", e);\n        return;\n      }\n    }\n\n    success(result, e);\n  });\n\n  // defer to let other handlers be assigned\n  setTimeout(function() {\n    request.send(body);\n  }, 0);\n\n  return request;\n\n}\n\n\ndocument.addEventListener('xhrfail', function(event) {\n  new notification.Error(event.reason);\n});\n\n\nmodule.exports = xhr;\n\n\n\n/** WEBPACK FOOTER **\n ** ./client/xhr.js\n **/","module.exports = function() {\n  var csrfCookie = document.cookie.match(/XSRF-TOKEN=([\\w-]+)/);\n  return csrfCookie ? csrfCookie[1] : null;\n};\n\n\n\n\n/** WEBPACK FOOTER **\n ** ./client/getCsrfCookie.js\n **/","exports.FormPayment = require('./formPayment');\n\n\n\n/** WEBPACK FOOTER **\n ** ./handlers/payments/common/client/index.js\n **/","var notification = require('client/notification');\nvar xhr = require('client/xhr');\nvar Spinner = require('client/spinner');\nvar Modal = require('client/head/modal');\n\n/**\n * Get data from orderForm.getOrderData()\n * process payment, ask for more data if needed\n */\nclass FormPayment {\n\n  constructor(orderForm, paymentMethodElem) {\n    this.orderForm = orderForm;\n    this.paymentMethodElem = paymentMethodElem;\n  }\n\n  request(options) {\n    var request = xhr(options);\n\n    request.addEventListener('loadstart', function() {\n      var onEnd = this.startRequestIndication();\n      request.addEventListener('loadend', onEnd);\n    }.bind(this));\n\n    return request;\n  }\n\n  startRequestIndication() {\n\n    this.paymentMethodElem.classList.add('modal-overlay_light');\n\n    var spinner = new Spinner({\n      elem:  this.paymentMethodElem.querySelector('[type=\"submit\"]'),\n      size:  'small',\n      class: '',\n      elemClass: 'button_loading'\n    });\n    spinner.start();\n\n    return () => {\n      this.paymentMethodElem.classList.remove('modal-overlay_light');\n      if (spinner) spinner.stop();\n    };\n\n  }\n\n  readPaymentData() {\n    var paymentData = {};\n\n    [].forEach.call(this.paymentMethodElem.querySelectorAll('input,select,textarea'), function(elem) {\n      if ( (elem.type == 'radio' || elem.type == 'checkbox') && !elem.checked) return;\n      paymentData[elem.name] = elem.value;\n    });\n\n    return paymentData;\n  }\n\n  submit() {\n\n    var orderData = this.orderForm.getOrderData();\n    if (!orderData) return;\n\n    var paymentData = this.readPaymentData();\n\n    if (!paymentData.paymentMethod) {\n      new notification.Error(\"Выберите метод оплаты.\");\n      return;\n    }\n\n    if (paymentData.paymentMethod == 'invoice' && !paymentData.invoiceCompanyName) {\n      new notification.Error(\"Укажите название компании.\");\n      this.paymentMethodElem.querySelector('[name=\"invoiceCompanyName\"]').focus();\n      return;\n    }\n\n    for (var key in paymentData) {\n      orderData[key] = paymentData[key];\n    }\n\n    var discountCode = window.location.search.match(/[?&]code=([-\\w]+)/);\n    if (discountCode) {\n      orderData.discountCode = discountCode[1];\n    }\n\n    // response status must be 200\n    var request = xhr({\n      method:         'POST',\n      url:            '/payments/common/checkout',\n      normalStatuses: [200, 403, 400],\n      body:           orderData\n    });\n\n    if (orderData.orderTemplate) {\n      window.ga('ec:addProduct', {\n        id:       this.orderForm.product,\n        variant:  orderData.orderTemplate,\n        price:    orderData.amount,\n        quantity: 1\n      });\n    }\n\n    window.ga('ec:setAction', 'checkout', {\n      step:   1,\n      option: orderData.paymentMethod\n    });\n\n    window.metrika.reachGoal('CHECKOUT', {\n      product: this.orderForm.product,\n      method:  orderData.paymentMethod,\n      price:   orderData.amount\n    });\n\n    window.ga('send', 'event', 'payment', 'checkout', 'ebook');\n    window.ga('send', 'event', 'payment', 'checkout-method-' + orderData.paymentMethod, this.orderForm.product);\n\n    var onEnd = this.startRequestIndication();\n\n    request.addEventListener('success', (event) => {\n\n      if (request.status == 403) {\n        new notification.Error(\"<p>\" + (event.result.description || event.result.message) + \"</p><p>Пожалуйста, начните оформление заново.</p><p>Если вы считаете, что на сервере ошибка &mdash; свяжитесь со <a href='mailto:orders@javascript.ru'>службой поддержки</a>.</p>\");\n        onEnd();\n        return;\n      }\n\n      if (request.status == 400) {\n        new notification.Error(\"<p>\" + event.result.message + \"</p><p>Если вы считаете, что произошла ошибка &mdash; свяжитесь со <a href='mailto:orders@javascript.ru'>службой поддержки</a>.</p>\");\n        onEnd();\n        return;\n      }\n\n      var result = event.result;\n\n      if (result.form) {\n        // don't stop the spinner while submitting the form to the payment system!\n        // (still in progress)\n\n        window.ga('ec:setAction', 'purchase', {\n          id: result.orderNumber\n        });\n\n        var container = document.createElement('div');\n        container.hidden = true;\n        container.innerHTML = result.form;\n        document.body.appendChild(container);\n\n\n        // submit form after GA or after 500ms, which one comes sooner\n        var submitForm = function() {\n          if (!submitForm.called) {\n            submitForm.called = true;\n            container.firstChild.submit();\n          }\n        };\n\n        window.ga('send', 'event', 'payment', 'purchase', 'ebook', {\n          hitCallback: submitForm\n        });\n        setTimeout(submitForm, 500);\n\n\n        window.metrika.reachGoal('PURCHASE', {\n          product: this.orderForm.product,\n          method:  orderData.paymentMethod,\n          price:   orderData.amount,\n          number:  result.orderNumber\n        });\n\n\n      } else {\n        console.error(result);\n        onEnd();\n        new notification.Error(\"Ошибка на сервере, свяжитесь со <a href='mailto:orders@javascript.ru'>службой поддержки</a>.\");\n      }\n    });\n\n    request.addEventListener('fail', onEnd);\n  }\n}\n\nmodule.exports = FormPayment;\n\n\n\n/** WEBPACK FOOTER **\n ** ./handlers/payments/common/client/formPayment.js\n **/","var xhr = require('client/xhr');\nvar notification = require('client/notification');\nvar delegate = require('client/delegate');\nvar FormPayment = require('payments/common/client').FormPayment;\nvar Spinner = require('client/spinner');\nvar Modal = require('client/head/modal');\n\nclass OrderForm {\n\n  constructor(options) {\n    this.elem = options.elem;\n\n    this.product = 'ebook';\n\n    this.elem.addEventListener('submit', (e) => this.onSubmit(e));\n\n    this.delegate('[data-order-payment-change]', 'click', function(e) {\n      e.preventDefault();\n      this.elem.querySelector('[data-order-form-step-payment]').style.display = 'block';\n      this.elem.querySelector('[data-order-form-step-confirm]').style.display = 'none';\n      this.elem.querySelector('[data-order-form-step-receipt]').style.display = 'none';\n    });\n\n    this.delegate('.complex-form__extract .extract__item', 'click', function(e) {\n      e.delegateTarget.querySelector('[type=\"radio\"]').checked = true;\n    });\n  }\n\n\n  onSubmit(event) {\n    event.preventDefault();\n    new FormPayment(this, this.elem).submit();\n  }\n\n\n  // return orderData or nothing if validation failed\n  getOrderData() {\n    var orderData = {    };\n\n    if (window.orderNumber) {\n      orderData.orderNumber = window.orderNumber;\n    } else {\n      var chooser = this.elem.querySelector('input[name=\"orderTemplate\"]:checked');\n      orderData.orderTemplate = chooser.value;\n      orderData.amount = chooser.dataset.amount; // for stats\n    }\n\n    if (this.elem.elements.email) {\n      if (!this.elem.elements.email.value) {\n        window.ga('send', 'event', 'payment', 'checkout-no-email', 'ebook');\n        window.metrika.reachGoal('CHECKOUT-NO-EMAIL', {product: 'ebook'});\n        new notification.Error(\"Введите email.\");\n        this.elem.elements.email.scrollIntoView();\n        setTimeout(function() {\n          window.scrollBy(0, -200);\n        }, 0);\n        this.elem.elements.email.focus();\n        return;\n      } else {\n        orderData.email = this.elem.elements.email.value;\n      }\n    }\n\n    return orderData;\n  }\n\n\n\n}\n\n\ndelegate.delegateMixin(OrderForm.prototype);\n\nmodule.exports = OrderForm;\n\n\n\n/** WEBPACK FOOTER **\n ** ./handlers/ebook/client/orderForm.js\n **/"],"sourceRoot":""}