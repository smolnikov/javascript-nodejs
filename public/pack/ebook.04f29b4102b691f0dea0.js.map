{"version":3,"sources":["webpack:///ebook.04f29b4102b691f0dea0.js","webpack:///./handlers/ebook/client/index.js","webpack:///./client/xhr.js?6852****","webpack:///./handlers/ebook/client/orderForm.js","webpack:///./client/getCsrfCookie.js?d12a****","webpack:///./handlers/payments/common/client/index.js?b91c","webpack:///./handlers/payments/common/client/formPayment.js?0610"],"names":["ebook","webpackJsonp_name_","module","exports","__webpack_require__","init","orderForm","document","querySelector","OrderForm","elem",28,"xhr","options","wrapEvent","name","e","event","CustomEvent","originalEvent","fail","reason","request","dispatchEvent","success","result","XMLHttpRequest","method","body","url","open","sync","csrfCookie","getCsrfCookie","skipCsrf","setRequestHeader","toString","call","JSON","stringify","noDocumentEvents","addEventListener","timeStart","Date","now","raw","normalStatuses","status","indexOf","responseText","contentType","getResponseHeader","match","json","parse","setTimeout","send","notification","Error",55,"_classCallCheck","instance","Constructor","TypeError","_createClass","defineProperties","target","props","i","length","descriptor","enumerable","configurable","writable","Object","defineProperty","key","protoProps","staticProps","prototype","delegate","FormPayment","_this","this","product","onSubmit","preventDefault","style","display","delegateTarget","checked","value","submit","orderData","window","orderNumber","chooser","orderTemplate","amount","dataset","elements","email","ga","metrika","reachGoal","scrollIntoView","scrollBy","focus","delegateMixin",77,"cookie",85,118,"Spinner","paymentMethodElem","onEnd","startRequestIndication","bind","classList","add","spinner","size","class","elemClass","start","remove","stop","paymentData","forEach","querySelectorAll","type","_this2","getOrderData","readPaymentData","paymentMethod","invoiceCompanyName","discountCode","location","search","id","variant","price","quantity","step","option","description","message","form","container","createElement","hidden","innerHTML","appendChild","submitForm","called","firstChild","hitCallback","number"],"mappings":"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","file":"ebook.04f29b4102b691f0dea0.js","sourcesContent":["var ebook =\nwebpackJsonp_name_([8],{\n\n/***/ 0:\n/***/ function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\t\n\tvar OrderForm = __webpack_require__(55);\n\t\n\tfunction init() {\n\t\n\t  var orderForm = document.querySelector('[data-order-form]');\n\t  if (orderForm) {\n\t    new OrderForm({\n\t      elem: orderForm\n\t    });\n\t  }\n\t}\n\t\n\tinit();\n\n/***/ },\n\n/***/ 28:\n/***/ function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\t\n\tvar notification = __webpack_require__(23);\n\tvar getCsrfCookie = __webpack_require__(77);\n\t// Wrapper about XHR\n\t// # Global Events\n\t// triggers document.loadstart/loadend on communication start/end\n\t//    --> unless options.noGlobalEvents is set\n\t//\n\t// # Events\n\t// triggers fail/success on load end:\n\t//    --> by default status=200 is ok, the others are failures\n\t//    --> options.normalStatuses = [201,409] allow given statuses\n\t//    --> fail event has .reason field\n\t//    --> success event has .result field\n\t//\n\t// # JSON\n\t//    --> send(object) calls JSON.stringify\n\t//    --> adds Accept: json (we want json) by default, unless options.raw\n\t// if options.json or server returned json content type\n\t//    --> autoparse json\n\t//    --> fail if error\n\t//\n\t// # CSRF\n\t//    --> requests sends header X-XSRF-TOKEN from cookie\n\t\n\tfunction xhr(options) {\n\t\n\t  var request = new XMLHttpRequest();\n\t\n\t  var method = options.method || 'GET';\n\t\n\t  var body = options.body;\n\t  var url = options.url;\n\t\n\t  request.open(method, url, options.sync ? false : true);\n\t\n\t  request.method = method;\n\t\n\t  // token/header names same as angular $http for easier interop\n\t  var csrfCookie = getCsrfCookie();\n\t  if (csrfCookie && !options.skipCsrf) {\n\t    request.setRequestHeader('X-XSRF-TOKEN', csrfCookie);\n\t  }\n\t\n\t  if (({}).toString.call(body) == '[object Object]') {\n\t    // must be OPENed to setRequestHeader\n\t    request.setRequestHeader('Content-Type', 'application/json;charset=UTF-8');\n\t    body = JSON.stringify(body);\n\t  }\n\t\n\t  if (!options.noDocumentEvents) {\n\t    request.addEventListener('loadstart', function (event) {\n\t      request.timeStart = Date.now();\n\t      var e = wrapEvent('xhrstart', event);\n\t      document.dispatchEvent(e);\n\t    });\n\t    request.addEventListener('loadend', function (event) {\n\t      var e = wrapEvent('xhrend', event);\n\t      document.dispatchEvent(e);\n\t    });\n\t    request.addEventListener('success', function (event) {\n\t      var e = wrapEvent('xhrsuccess', event);\n\t      e.result = event.result;\n\t      document.dispatchEvent(e);\n\t    });\n\t    request.addEventListener('fail', function (event) {\n\t      var e = wrapEvent('xhrfail', event);\n\t      e.reason = event.reason;\n\t      document.dispatchEvent(e);\n\t    });\n\t  }\n\t\n\t  if (!options.raw) {\n\t    // means we want json\n\t    request.setRequestHeader('Accept', 'application/json');\n\t  }\n\t\n\t  request.setRequestHeader('X-Requested-With', 'XMLHttpRequest');\n\t\n\t  var normalStatuses = options.normalStatuses || [200];\n\t\n\t  function wrapEvent(name, e) {\n\t    var event = new CustomEvent(name);\n\t    event.originalEvent = e;\n\t    return event;\n\t  }\n\t\n\t  function fail(reason, originalEvent) {\n\t    var e = wrapEvent('fail', originalEvent);\n\t    e.reason = reason;\n\t    request.dispatchEvent(e);\n\t  }\n\t\n\t  function success(result, originalEvent) {\n\t    var e = wrapEvent('success', originalEvent);\n\t    e.result = result;\n\t    request.dispatchEvent(e);\n\t  }\n\t\n\t  request.addEventListener('error', function (e) {\n\t    fail('Ошибка связи с сервером.', e);\n\t  });\n\t\n\t  request.addEventListener('timeout', function (e) {\n\t    fail('Превышено максимально допустимое время ожидания ответа от сервера.', e);\n\t  });\n\t\n\t  request.addEventListener('abort', function (e) {\n\t    fail('Запрос был прерван.', e);\n\t  });\n\t\n\t  request.addEventListener('load', function (e) {\n\t    if (!request.status) {\n\t      // does that ever happen?\n\t      fail('Не получен ответ от сервера.', e);\n\t      return;\n\t    }\n\t\n\t    if (normalStatuses.indexOf(request.status) == -1) {\n\t      fail('Ошибка на стороне сервера (код ' + request.status + '), попытайтесь позднее.', e);\n\t      return;\n\t    }\n\t\n\t    var result = request.responseText;\n\t    var contentType = request.getResponseHeader('Content-Type');\n\t    if (contentType.match(/^application\\/json/) || options.json) {\n\t      // autoparse json if WANT or RECEIVED json\n\t      try {\n\t        result = JSON.parse(result);\n\t      } catch (e) {\n\t        fail('Некорректный формат ответа от сервера.', e);\n\t        return;\n\t      }\n\t    }\n\t\n\t    success(result, e);\n\t  });\n\t\n\t  // defer to let other handlers be assigned\n\t  setTimeout(function () {\n\t    request.send(body);\n\t  }, 0);\n\t\n\t  return request;\n\t}\n\t\n\tdocument.addEventListener('xhrfail', function (event) {\n\t  new notification.Error(event.reason);\n\t});\n\t\n\tmodule.exports = xhr;\n\n/***/ },\n\n/***/ 55:\n/***/ function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\t\n\tvar _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ('value' in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();\n\t\n\tfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError('Cannot call a class as a function'); } }\n\t\n\tvar xhr = __webpack_require__(28);\n\tvar notification = __webpack_require__(23);\n\tvar delegate = __webpack_require__(27);\n\tvar FormPayment = __webpack_require__(85).FormPayment;\n\tvar Spinner = __webpack_require__(53);\n\tvar Modal = __webpack_require__(10);\n\t\n\tvar OrderForm = (function () {\n\t  function OrderForm(options) {\n\t    var _this = this;\n\t\n\t    _classCallCheck(this, OrderForm);\n\t\n\t    this.elem = options.elem;\n\t\n\t    this.product = 'ebook';\n\t\n\t    this.elem.addEventListener('submit', function (e) {\n\t      return _this.onSubmit(e);\n\t    });\n\t\n\t    this.delegate('[data-order-payment-change]', 'click', function (e) {\n\t      e.preventDefault();\n\t      this.elem.querySelector('[data-order-form-step-payment]').style.display = 'block';\n\t      this.elem.querySelector('[data-order-form-step-confirm]').style.display = 'none';\n\t      this.elem.querySelector('[data-order-form-step-receipt]').style.display = 'none';\n\t    });\n\t\n\t    this.delegate('.complex-form__extract .extract__item', 'click', function (e) {\n\t      e.delegateTarget.querySelector('[type=\"radio\"]').checked = true;\n\t    });\n\t  }\n\t\n\t  _createClass(OrderForm, [{\n\t    key: 'onSubmit',\n\t    value: function onSubmit(event) {\n\t      event.preventDefault();\n\t      new FormPayment(this, this.elem).submit();\n\t    }\n\t  }, {\n\t    key: 'getOrderData',\n\t\n\t    // return orderData or nothing if validation failed\n\t    value: function getOrderData() {\n\t      var orderData = {};\n\t\n\t      if (window.orderNumber) {\n\t        orderData.orderNumber = window.orderNumber;\n\t      } else {\n\t        var chooser = this.elem.querySelector('input[name=\"orderTemplate\"]:checked');\n\t        orderData.orderTemplate = chooser.value;\n\t        orderData.amount = chooser.dataset.amount; // for stats\n\t      }\n\t\n\t      if (this.elem.elements.email) {\n\t        if (!this.elem.elements.email.value) {\n\t          window.ga('send', 'event', 'payment', 'checkout-no-email', 'ebook');\n\t          window.metrika.reachGoal('CHECKOUT-NO-EMAIL', { product: 'ebook' });\n\t          new notification.Error('Введите email.');\n\t          this.elem.elements.email.scrollIntoView();\n\t          setTimeout(function () {\n\t            window.scrollBy(0, -200);\n\t          }, 0);\n\t          this.elem.elements.email.focus();\n\t          return;\n\t        } else {\n\t          orderData.email = this.elem.elements.email.value;\n\t        }\n\t      }\n\t\n\t      return orderData;\n\t    }\n\t  }]);\n\t\n\t  return OrderForm;\n\t})();\n\t\n\tdelegate.delegateMixin(OrderForm.prototype);\n\t\n\tmodule.exports = OrderForm;\n\n/***/ },\n\n/***/ 77:\n/***/ function(module, exports, __webpack_require__) {\n\n\t\"use strict\";\n\t\n\tmodule.exports = function () {\n\t  var csrfCookie = document.cookie.match(/XSRF-TOKEN=([\\w-]+)/);\n\t  return csrfCookie ? csrfCookie[1] : null;\n\t};\n\n/***/ },\n\n/***/ 85:\n/***/ function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\t\n\texports.FormPayment = __webpack_require__(118);\n\n/***/ },\n\n/***/ 118:\n/***/ function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\t\n\tvar _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ('value' in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();\n\t\n\tfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError('Cannot call a class as a function'); } }\n\t\n\tvar notification = __webpack_require__(23);\n\tvar xhr = __webpack_require__(28);\n\tvar Spinner = __webpack_require__(53);\n\tvar Modal = __webpack_require__(10);\n\t\n\t/**\n\t * Get data from orderForm.getOrderData()\n\t * process payment, ask for more data if needed\n\t */\n\t\n\tvar FormPayment = (function () {\n\t  function FormPayment(orderForm, paymentMethodElem) {\n\t    _classCallCheck(this, FormPayment);\n\t\n\t    this.orderForm = orderForm;\n\t    this.paymentMethodElem = paymentMethodElem;\n\t  }\n\t\n\t  _createClass(FormPayment, [{\n\t    key: 'request',\n\t    value: function request(options) {\n\t      var request = xhr(options);\n\t\n\t      request.addEventListener('loadstart', (function () {\n\t        var onEnd = this.startRequestIndication();\n\t        request.addEventListener('loadend', onEnd);\n\t      }).bind(this));\n\t\n\t      return request;\n\t    }\n\t  }, {\n\t    key: 'startRequestIndication',\n\t    value: function startRequestIndication() {\n\t      var _this = this;\n\t\n\t      this.paymentMethodElem.classList.add('modal-overlay_light');\n\t\n\t      var spinner = new Spinner({\n\t        elem: this.paymentMethodElem.querySelector('[type=\"submit\"]'),\n\t        size: 'small',\n\t        'class': '',\n\t        elemClass: 'button_loading'\n\t      });\n\t      spinner.start();\n\t\n\t      return function () {\n\t        _this.paymentMethodElem.classList.remove('modal-overlay_light');\n\t        if (spinner) spinner.stop();\n\t      };\n\t    }\n\t  }, {\n\t    key: 'readPaymentData',\n\t    value: function readPaymentData() {\n\t      var paymentData = {};\n\t\n\t      [].forEach.call(this.paymentMethodElem.querySelectorAll('input,select,textarea'), function (elem) {\n\t        if ((elem.type == 'radio' || elem.type == 'checkbox') && !elem.checked) return;\n\t        paymentData[elem.name] = elem.value;\n\t      });\n\t\n\t      return paymentData;\n\t    }\n\t  }, {\n\t    key: 'submit',\n\t    value: function submit() {\n\t      var _this2 = this;\n\t\n\t      var orderData = this.orderForm.getOrderData();\n\t      if (!orderData) return;\n\t\n\t      var paymentData = this.readPaymentData();\n\t\n\t      if (!paymentData.paymentMethod) {\n\t        new notification.Error('Выберите метод оплаты.');\n\t        return;\n\t      }\n\t\n\t      if (paymentData.paymentMethod == 'invoice' && !paymentData.invoiceCompanyName) {\n\t        new notification.Error('Укажите название компании.');\n\t        this.paymentMethodElem.querySelector('[name=\"invoiceCompanyName\"]').focus();\n\t        return;\n\t      }\n\t\n\t      for (var key in paymentData) {\n\t        orderData[key] = paymentData[key];\n\t      }\n\t\n\t      var discountCode = window.location.search.match(/[?&]code=(\\w+)/);\n\t      if (discountCode) {\n\t        orderData.discountCode = discountCode[1];\n\t      }\n\t\n\t      // response status must be 200\n\t      var request = xhr({\n\t        method: 'POST',\n\t        url: '/payments/common/checkout',\n\t        normalStatuses: [200, 403, 400],\n\t        body: orderData\n\t      });\n\t\n\t      if (orderData.orderTemplate) {\n\t        window.ga('ec:addProduct', {\n\t          id: this.orderForm.product,\n\t          variant: orderData.orderTemplate,\n\t          price: orderData.amount,\n\t          quantity: 1\n\t        });\n\t      }\n\t\n\t      window.ga('ec:setAction', 'checkout', {\n\t        step: 1,\n\t        option: orderData.paymentMethod\n\t      });\n\t\n\t      window.metrika.reachGoal('CHECKOUT', {\n\t        product: this.orderForm.product,\n\t        method: orderData.paymentMethod,\n\t        price: orderData.amount\n\t      });\n\t\n\t      window.ga('send', 'event', 'payment', 'checkout', 'ebook');\n\t      window.ga('send', 'event', 'payment', 'checkout-method-' + orderData.paymentMethod, this.orderForm.product);\n\t\n\t      var onEnd = this.startRequestIndication();\n\t\n\t      request.addEventListener('success', function (event) {\n\t\n\t        if (request.status == 403) {\n\t          new notification.Error('<p>' + (event.result.description || event.result.message) + '</p><p>Пожалуйста, начните оформление заново.</p><p>Если вы считаете, что на сервере ошибка &mdash; свяжитесь со <a href=\\'mailto:orders@javascript.ru\\'>службой поддержки</a>.</p>');\n\t          onEnd();\n\t          return;\n\t        }\n\t\n\t        if (request.status == 400) {\n\t          new notification.Error('<p>' + event.result.message + '</p><p>Если вы считаете, что произошла ошибка &mdash; свяжитесь со <a href=\\'mailto:orders@javascript.ru\\'>службой поддержки</a>.</p>');\n\t          onEnd();\n\t          return;\n\t        }\n\t\n\t        var result = event.result;\n\t\n\t        if (result.form) {\n\t          // don't stop the spinner while submitting the form to the payment system!\n\t          // (still in progress)\n\t\n\t          window.ga('ec:setAction', 'purchase', {\n\t            id: result.orderNumber\n\t          });\n\t\n\t          var container = document.createElement('div');\n\t          container.hidden = true;\n\t          container.innerHTML = result.form;\n\t          document.body.appendChild(container);\n\t\n\t          // submit form after GA or after 500ms, which one comes sooner\n\t          var submitForm = function submitForm() {\n\t            if (!submitForm.called) {\n\t              submitForm.called = true;\n\t              container.firstChild.submit();\n\t            }\n\t          };\n\t\n\t          window.ga('send', 'event', 'payment', 'purchase', 'ebook', {\n\t            hitCallback: submitForm\n\t          });\n\t          setTimeout(submitForm, 500);\n\t\n\t          window.metrika.reachGoal('PURCHASE', {\n\t            product: _this2.orderForm.product,\n\t            method: orderData.paymentMethod,\n\t            price: orderData.amount,\n\t            number: result.orderNumber\n\t          });\n\t        } else {\n\t          console.error(result);\n\t          onEnd();\n\t          new notification.Error('Ошибка на сервере, свяжитесь со <a href=\\'mailto:orders@javascript.ru\\'>службой поддержки</a>.');\n\t        }\n\t      });\n\t\n\t      request.addEventListener('fail', onEnd);\n\t    }\n\t  }]);\n\t\n\t  return FormPayment;\n\t})();\n\t\n\tmodule.exports = FormPayment;\n\n/***/ }\n\n});\n\n\n/** WEBPACK FOOTER **\n ** ebook.04f29b4102b691f0dea0.js\n **/","var OrderForm = require('./orderForm');\n\nfunction init() {\n\n\n  var orderForm = document.querySelector('[data-order-form]');\n  if (orderForm) {\n    new OrderForm({\n      elem: orderForm\n    });\n  }\n\n}\n\ninit();\n\n\n\n/** WEBPACK FOOTER **\n ** ./handlers/ebook/client/index.js\n **/","var notification = require('client/notification');\nvar getCsrfCookie = require('client/getCsrfCookie');\n// Wrapper about XHR\n// # Global Events\n// triggers document.loadstart/loadend on communication start/end\n//    --> unless options.noGlobalEvents is set\n//\n// # Events\n// triggers fail/success on load end:\n//    --> by default status=200 is ok, the others are failures\n//    --> options.normalStatuses = [201,409] allow given statuses\n//    --> fail event has .reason field\n//    --> success event has .result field\n//\n// # JSON\n//    --> send(object) calls JSON.stringify\n//    --> adds Accept: json (we want json) by default, unless options.raw\n// if options.json or server returned json content type\n//    --> autoparse json\n//    --> fail if error\n//\n// # CSRF\n//    --> requests sends header X-XSRF-TOKEN from cookie\n\nfunction xhr(options) {\n\n  var request = new XMLHttpRequest();\n\n  var method = options.method || 'GET';\n\n  var body = options.body;\n  var url = options.url;\n\n  request.open(method, url, options.sync ? false : true);\n\n  request.method = method;\n\n  // token/header names same as angular $http for easier interop\n  var csrfCookie = getCsrfCookie();\n  if (csrfCookie && !options.skipCsrf) {\n    request.setRequestHeader(\"X-XSRF-TOKEN\", csrfCookie);\n  }\n\n  if ({}.toString.call(body) == '[object Object]') {\n    // must be OPENed to setRequestHeader\n    request.setRequestHeader(\"Content-Type\", \"application/json;charset=UTF-8\");\n    body = JSON.stringify(body);\n  }\n\n  if (!options.noDocumentEvents) {\n    request.addEventListener('loadstart', event => {\n      request.timeStart = Date.now();\n      var e = wrapEvent('xhrstart', event);\n      document.dispatchEvent(e);\n    });\n    request.addEventListener('loadend', event => {\n      var e = wrapEvent('xhrend', event);\n      document.dispatchEvent(e);\n    });\n    request.addEventListener('success', event => {\n      var e = wrapEvent('xhrsuccess', event);\n      e.result = event.result;\n      document.dispatchEvent(e);\n    });\n    request.addEventListener('fail', event => {\n      var e = wrapEvent('xhrfail', event);\n      e.reason = event.reason;\n      document.dispatchEvent(e);\n    });\n  }\n\n  if (!options.raw) { // means we want json\n    request.setRequestHeader(\"Accept\", \"application/json\");\n  }\n\n  request.setRequestHeader('X-Requested-With', \"XMLHttpRequest\");\n\n  var normalStatuses = options.normalStatuses || [200];\n\n  function wrapEvent(name, e) {\n    var event = new CustomEvent(name);\n    event.originalEvent = e;\n    return event;\n  }\n\n  function fail(reason, originalEvent) {\n    var e = wrapEvent(\"fail\", originalEvent);\n    e.reason = reason;\n    request.dispatchEvent(e);\n  }\n\n  function success(result, originalEvent) {\n    var e = wrapEvent(\"success\", originalEvent);\n    e.result = result;\n    request.dispatchEvent(e);\n  }\n\n  request.addEventListener(\"error\", e => {\n    fail(\"Ошибка связи с сервером.\", e);\n  });\n\n  request.addEventListener(\"timeout\", e => {\n    fail(\"Превышено максимально допустимое время ожидания ответа от сервера.\", e);\n  });\n\n  request.addEventListener(\"abort\", e => {\n    fail(\"Запрос был прерван.\", e);\n  });\n\n  request.addEventListener(\"load\", e => {\n    if (!request.status) { // does that ever happen?\n      fail(\"Не получен ответ от сервера.\", e);\n      return;\n    }\n\n    if (normalStatuses.indexOf(request.status) == -1) {\n      fail(\"Ошибка на стороне сервера (код \" + request.status + \"), попытайтесь позднее.\", e);\n      return;\n    }\n\n    var result = request.responseText;\n    var contentType = request.getResponseHeader(\"Content-Type\");\n    if (contentType.match(/^application\\/json/) || options.json) { // autoparse json if WANT or RECEIVED json\n      try {\n        result = JSON.parse(result);\n      } catch (e) {\n        fail(\"Некорректный формат ответа от сервера.\", e);\n        return;\n      }\n    }\n\n    success(result, e);\n  });\n\n  // defer to let other handlers be assigned\n  setTimeout(function() {\n    request.send(body);\n  }, 0);\n\n  return request;\n\n}\n\n\ndocument.addEventListener('xhrfail', function(event) {\n  new notification.Error(event.reason);\n});\n\n\nmodule.exports = xhr;\n\n\n\n/** WEBPACK FOOTER **\n ** ./client/xhr.js\n **/","var xhr = require('client/xhr');\nvar notification = require('client/notification');\nvar delegate = require('client/delegate');\nvar FormPayment = require('payments/common/client').FormPayment;\nvar Spinner = require('client/spinner');\nvar Modal = require('client/head/modal');\n\nclass OrderForm {\n\n  constructor(options) {\n    this.elem = options.elem;\n\n    this.product = 'ebook';\n\n    this.elem.addEventListener('submit', (e) => this.onSubmit(e));\n\n    this.delegate('[data-order-payment-change]', 'click', function(e) {\n      e.preventDefault();\n      this.elem.querySelector('[data-order-form-step-payment]').style.display = 'block';\n      this.elem.querySelector('[data-order-form-step-confirm]').style.display = 'none';\n      this.elem.querySelector('[data-order-form-step-receipt]').style.display = 'none';\n    });\n\n    this.delegate('.complex-form__extract .extract__item', 'click', function(e) {\n      e.delegateTarget.querySelector('[type=\"radio\"]').checked = true;\n    });\n  }\n\n\n  onSubmit(event) {\n    event.preventDefault();\n    new FormPayment(this, this.elem).submit();\n  }\n\n\n  // return orderData or nothing if validation failed\n  getOrderData() {\n    var orderData = {    };\n\n    if (window.orderNumber) {\n      orderData.orderNumber = window.orderNumber;\n    } else {\n      var chooser = this.elem.querySelector('input[name=\"orderTemplate\"]:checked');\n      orderData.orderTemplate = chooser.value;\n      orderData.amount = chooser.dataset.amount; // for stats\n    }\n\n    if (this.elem.elements.email) {\n      if (!this.elem.elements.email.value) {\n        window.ga('send', 'event', 'payment', 'checkout-no-email', 'ebook');\n        window.metrika.reachGoal('CHECKOUT-NO-EMAIL', {product: 'ebook'});\n        new notification.Error(\"Введите email.\");\n        this.elem.elements.email.scrollIntoView();\n        setTimeout(function() {\n          window.scrollBy(0, -200);\n        }, 0);\n        this.elem.elements.email.focus();\n        return;\n      } else {\n        orderData.email = this.elem.elements.email.value;\n      }\n    }\n\n    return orderData;\n  }\n\n\n\n}\n\n\ndelegate.delegateMixin(OrderForm.prototype);\n\nmodule.exports = OrderForm;\n\n\n\n/** WEBPACK FOOTER **\n ** ./handlers/ebook/client/orderForm.js\n **/","module.exports = function() {\n  var csrfCookie = document.cookie.match(/XSRF-TOKEN=([\\w-]+)/);\n  return csrfCookie ? csrfCookie[1] : null;\n};\n\n\n\n\n/** WEBPACK FOOTER **\n ** ./client/getCsrfCookie.js\n **/","exports.FormPayment = require('./formPayment');\n\n\n\n/** WEBPACK FOOTER **\n ** ./handlers/payments/common/client/index.js\n **/","var notification = require('client/notification');\nvar xhr = require('client/xhr');\nvar Spinner = require('client/spinner');\nvar Modal = require('client/head/modal');\n\n/**\n * Get data from orderForm.getOrderData()\n * process payment, ask for more data if needed\n */\nclass FormPayment {\n\n  constructor(orderForm, paymentMethodElem) {\n    this.orderForm = orderForm;\n    this.paymentMethodElem = paymentMethodElem;\n  }\n\n  request(options) {\n    var request = xhr(options);\n\n    request.addEventListener('loadstart', function() {\n      var onEnd = this.startRequestIndication();\n      request.addEventListener('loadend', onEnd);\n    }.bind(this));\n\n    return request;\n  }\n\n  startRequestIndication() {\n\n    this.paymentMethodElem.classList.add('modal-overlay_light');\n\n    var spinner = new Spinner({\n      elem:  this.paymentMethodElem.querySelector('[type=\"submit\"]'),\n      size:  'small',\n      class: '',\n      elemClass: 'button_loading'\n    });\n    spinner.start();\n\n    return () => {\n      this.paymentMethodElem.classList.remove('modal-overlay_light');\n      if (spinner) spinner.stop();\n    };\n\n  }\n\n  readPaymentData() {\n    var paymentData = {};\n\n    [].forEach.call(this.paymentMethodElem.querySelectorAll('input,select,textarea'), function(elem) {\n      if ( (elem.type == 'radio' || elem.type == 'checkbox') && !elem.checked) return;\n      paymentData[elem.name] = elem.value;\n    });\n\n    return paymentData;\n  }\n\n  submit() {\n\n    var orderData = this.orderForm.getOrderData();\n    if (!orderData) return;\n\n    var paymentData = this.readPaymentData();\n\n    if (!paymentData.paymentMethod) {\n      new notification.Error(\"Выберите метод оплаты.\");\n      return;\n    }\n\n    if (paymentData.paymentMethod == 'invoice' && !paymentData.invoiceCompanyName) {\n      new notification.Error(\"Укажите название компании.\");\n      this.paymentMethodElem.querySelector('[name=\"invoiceCompanyName\"]').focus();\n      return;\n    }\n\n    for (var key in paymentData) {\n      orderData[key] = paymentData[key];\n    }\n\n    var discountCode = window.location.search.match(/[?&]code=(\\w+)/);\n    if (discountCode) {\n      orderData.discountCode = discountCode[1];\n    }\n\n    // response status must be 200\n    var request = xhr({\n      method:         'POST',\n      url:            '/payments/common/checkout',\n      normalStatuses: [200, 403, 400],\n      body:           orderData\n    });\n\n    if (orderData.orderTemplate) {\n      window.ga('ec:addProduct', {\n        id:       this.orderForm.product,\n        variant:  orderData.orderTemplate,\n        price:    orderData.amount,\n        quantity: 1\n      });\n    }\n\n    window.ga('ec:setAction', 'checkout', {\n      step:   1,\n      option: orderData.paymentMethod\n    });\n\n    window.metrika.reachGoal('CHECKOUT', {\n      product: this.orderForm.product,\n      method:  orderData.paymentMethod,\n      price:   orderData.amount\n    });\n\n    window.ga('send', 'event', 'payment', 'checkout', 'ebook');\n    window.ga('send', 'event', 'payment', 'checkout-method-' + orderData.paymentMethod, this.orderForm.product);\n\n    var onEnd = this.startRequestIndication();\n\n    request.addEventListener('success', (event) => {\n\n      if (request.status == 403) {\n        new notification.Error(\"<p>\" + (event.result.description || event.result.message) + \"</p><p>Пожалуйста, начните оформление заново.</p><p>Если вы считаете, что на сервере ошибка &mdash; свяжитесь со <a href='mailto:orders@javascript.ru'>службой поддержки</a>.</p>\");\n        onEnd();\n        return;\n      }\n\n      if (request.status == 400) {\n        new notification.Error(\"<p>\" + event.result.message + \"</p><p>Если вы считаете, что произошла ошибка &mdash; свяжитесь со <a href='mailto:orders@javascript.ru'>службой поддержки</a>.</p>\");\n        onEnd();\n        return;\n      }\n\n      var result = event.result;\n\n      if (result.form) {\n        // don't stop the spinner while submitting the form to the payment system!\n        // (still in progress)\n\n        window.ga('ec:setAction', 'purchase', {\n          id: result.orderNumber\n        });\n\n        var container = document.createElement('div');\n        container.hidden = true;\n        container.innerHTML = result.form;\n        document.body.appendChild(container);\n\n\n        // submit form after GA or after 500ms, which one comes sooner\n        var submitForm = function() {\n          if (!submitForm.called) {\n            submitForm.called = true;\n            container.firstChild.submit();\n          }\n        };\n\n        window.ga('send', 'event', 'payment', 'purchase', 'ebook', {\n          hitCallback: submitForm\n        });\n        setTimeout(submitForm, 500);\n\n\n        window.metrika.reachGoal('PURCHASE', {\n          product: this.orderForm.product,\n          method:  orderData.paymentMethod,\n          price:   orderData.amount,\n          number:  result.orderNumber\n        });\n\n\n      } else {\n        console.error(result);\n        onEnd();\n        new notification.Error(\"Ошибка на сервере, свяжитесь со <a href='mailto:orders@javascript.ru'>службой поддержки</a>.\");\n      }\n    });\n\n    request.addEventListener('fail', onEnd);\n  }\n}\n\nmodule.exports = FormPayment;\n\n\n\n/** WEBPACK FOOTER **\n ** ./handlers/payments/common/client/formPayment.js\n **/"],"sourceRoot":""}